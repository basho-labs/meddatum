#!/usr/bin/env escript


main([Mode, File])->
    {ok,Path} = file:get_cwd(),
    code:add_pathz(Path ++ "/ebin"),
    io:setopts([{encoding, unicode}]),
    io:format(standard_error, "~p~n", [File]),
    ModeAtom = case Mode of
                   "dpc" -> dpc;
                   "med" -> med
               end,
    {ok, Records} = rezept:from_file(File, ModeAtom),
    lists:foreach(fun({ok, JSON}) ->
                          io:format("~ts~n", [JSON]);
                     ({error, E}) ->
                          io:format("error: ~p~n", [E])
                  end,
                  lists:map(fun rezept:to_json/1, lists:reverse(Records))).
